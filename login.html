<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Kick Off Scholars</title>
    <link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@400;700&family=Aileron:wght@400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<header>
  <nav class="menu2">
    <div class="logo2">
      <img src="logodef.png" alt="Logo de Kick Off Scholars">
    </div>
    <ul class="menu-items2">
      <li><a href="index.html">Inicio</a></li>
      <li><a href="quienes-somos.html">Quiénes Somos</a></li>
      <li><a href="index.html#servicios">Nuestros Servicios</a></li>
      <li><a href="contacto.html">Contacto</a></li>
      <li><a href="login.html" class="active">Log in</a></li>
    </ul>
  </nav>
</header>

<main>
    <section id="portal-clientes" class="portal">
        <h1>Portal de Clientes</h1>

        <div id="form-container">
            <!-- Formulario de Registro -->
            <div id="register-form" class="formulario activo">
                <h2>Registro</h2>
                <form id="register">
                    <label for="username">Nombre de usuario:</label>
                    <input type="text" id="username" placeholder="Escribe tu nombre de usuario" required />
                    <label for="email">Correo Electrónico:</label>
                    <input type="email" id="email" placeholder="ejemplo@correo.com" required />
                    <label for="password">Contraseña:</label>
                    <input type="password" id="password" placeholder="Crea tu contraseña" required />
                    <button type="submit" class="btn-transicion">Registrarse</button>
                </form>
                <p id="register-message" style="color: red;"></p>
                <p class="form-switch">
                    ¿Ya tienes cuenta? <a href="#" onclick="toggleForms('login-form')">Inicia sesión aquí</a>.
                </p>
            </div>

            <!-- Formulario de Login -->
            <div id="login-form" class="formulario oculto">
                <h2>Iniciar Sesión</h2>
                <form id="login">
                    <label for="login-email">Correo Electrónico:</label>
                    <input type="email" id="login-email" placeholder="ejemplo@correo.com" required />
                    <label for="login-password">Contraseña:</label>
                    <input type="password" id="login-password" placeholder="Escribe tu contraseña" required />
                    <button type="submit" class="btn-transicion">Entrar</button>
                </form>
                <p id="login-message" style="color: red;"></p>
                <p class="form-switch">
                    ¿No tienes cuenta? <a href="#" onclick="toggleForms('register-form')">Regístrate aquí</a>.
                </p>
            </div>
        </div>
    </section>
</main>

<footer>
    <p>&copy; 2025 Kick Off Scholars - Todos los derechos reservados</p>
</footer>

<script type="module">
    // Importar Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";
    import { getFirestore, setDoc, doc } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";

    // Configuración de Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyCVwQO4CJKFns0btIZRRch-hkJTpuaFCr0",
        authDomain: "kickoffscholars-88767.firebaseapp.com",
        projectId: "kickoffscholars-88767",
        storageBucket: "kickoffscholars-88767.firebasestorage.app",
        messagingSenderId: "307881292779",
        appId: "1:307881292779:web:5adb5b37acbbbb11a59fae"
    };

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Validación de entradas
    function validateInputs(username, email, password) {
        if (!username || !email || !password) {
            return "Todos los campos son obligatorios.";
        }
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            return "El correo electrónico no es válido.";
        }
        if (password.length < 8) {
            return "La contraseña debe tener al menos 8 caracteres.";
        }
        return null;
    }

    // Registrar nuevo usuario
    document.getElementById("register").addEventListener("submit", async (e) => {
        e.preventDefault();
        const username = document.getElementById("username").value.trim();
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value.trim();
        const messageEl = document.getElementById("register-message");

        const validationError = validateInputs(username, email, password);
        if (validationError) {
            messageEl.style.color = "red";
            messageEl.textContent = validationError;
            return;
        }

        try {
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            const user = userCredential.user;

            await setDoc(doc(db, "clientes", user.uid), {
                nombre: username,
                email: email,
                etapa: "Etapa inicial",
                archivosFaltantes: "Por definir",
                archivosSubidos: "Por definir",
                montoAbonado: 0,
                montoPorAbonar: 100
            });

            messageEl.style.color = "green";
            messageEl.textContent = "Registro exitoso. Redirigiendo...";
            setTimeout(() => {
                window.location.href = "portal.html";
            }, 2000);
        } catch (error) {
            console.error("Error al registrar usuario:", error.message);
            messageEl.style.color = "red";
            if (error.code === "auth/email-already-in-use") {
                messageEl.textContent = "El correo electrónico ya está en uso.";
            } else if (error.code === "auth/weak-password") {
                messageEl.textContent = "La contraseña es demasiado débil.";
            } else {
                messageEl.textContent = "Error: " + error.message;
            }
        }
    });

    // Manejo del formulario de inicio de sesión
    document.getElementById("login").addEventListener("submit", async (e) => {
        e.preventDefault();
        const email = document.getElementById("login-email").value.trim();
        const password = document.getElementById("login-password").value.trim();
        const messageEl = document.getElementById("login-message");

        try {
            const userCredential = await signInWithEmailAndPassword(auth, email, password);
            const user = userCredential.user;

            messageEl.style.color = "green";
            messageEl.textContent = `Bienvenido de nuevo, ${user.email}. Redirigiendo...`;
            setTimeout(() => {
                window.location.href = "portal.html";
            }, 2000);
        } catch (error) {
            console.error("Error al iniciar sesión:", error.message);
            messageEl.style.color = "red";
            messageEl.textContent = "Error: " + error.message;
        }
    });

    // Alternar formularios
    function toggleForms(formId) {
        document.getElementById("register-form").classList.toggle("activo", formId === "register-form");
        document.getElementById("login-form").classList.toggle("activo", formId === "login-form");
        document.getElementById("register-form").classList.toggle("oculto", formId !== "register-form");
        document.getElementById("login-form").classList.toggle("oculto", formId !== "login-form");
    }
</script>

</body>
</html>
